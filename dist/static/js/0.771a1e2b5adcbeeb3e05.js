webpackJsonp([0],{Exlg:function(t,e){},W2Q3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("XRGU"),i={props:{identifyCode:{type:String,default:""},canvasName:{type:String,default:"canvasCode"},fontSizeMin:{type:Number,default:20},fontSizeMax:{type:Number,default:30},contentWidth:{type:Number,default:116},contentHeight:{type:Number,default:50}},data:function(){return{}},methods:{randomNum:function(t,e){return Math.floor(Math.random()*(e-t)+t)},randomColor:function(t,e){return"rgb("+this.randomNum(t,e)+","+this.randomNum(t,e)+","+this.randomNum(t,e)+")"},drawPic:function(){var t=document.querySelector("#"+this.canvasName).getContext("2d");t.clearRect(0,0,this.contentWidth,this.contentHeight),t.textBaseline="bottom",t.fillStyle="rgba(255, 255, 255, .1)",t.fillRect(0,0,this.contentWidth,this.contentHeight);for(var e=0;e<this.identifyCode.length;e++)this.drawText(t,this.identifyCode[e],e);this.drawDot(t)},drawText:function(t,e,n){t.fillStyle=this.randomColor(50,160),t.font=this.randomNum(this.fontSizeMin,this.fontSizeMax)+"px SimHei";var o=(n+1)*(this.contentWidth/(this.identifyCode.length+1)),i=this.randomNum(this.fontSizeMax,this.contentHeight-5),a=this.randomNum(-30,30);t.translate(o,i),t.rotate(a*Math.PI/180),t.fillText(e,0,0),t.rotate(-a*Math.PI/180),t.translate(-o,-i)},drawLine:function(t){for(var e=0;e<1;e++)t.strokeStyle=this.randomColor(100,200),t.beginPath(),t.moveTo(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight)),t.lineTo(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight)),t.stroke()},drawDot:function(t){for(var e=0;e<20;e++)t.fillStyle=this.randomColor(0,255),t.beginPath(),t.arc(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight),1,0,2*Math.PI),t.fill()}},watch:{identifyCode:function(){this.drawPic()}},mounted:function(){this.drawPic()}},a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"s-canvas"},[e("canvas",{attrs:{id:this.canvasName,width:this.contentWidth,height:this.contentHeight}})])},staticRenderFns:[]};var r={data:function(){return{pwdShow:!1,showPicker:!1,identifyCode:"",loginForm:{userName:"",password:"",code:"",lang:""},langData:[{text:"中文",value:"zh"},{text:"English",value:"en"}]}},created:function(){},mounted:function(){this.loginForm.lang="zh"===localStorage.getItem("language")?"中文":"English",this.refreshCode()},methods:{refreshCode:function(){var t=this;this.$api.login.getCode().then(function(e){e.record?t.identifyCode=e.record.html.verificationCode:t.$toast(t.$t("message.getVerificationFail"))})},codeValidator:function(t){return""!==t&&void 0!==t&&null!==t&&(4===t.length&&t===this.identifyCode)},codeMessage:function(t){return""===t||void 0===t||null===t?this.$t("formPrompt.codeEmpty"):4!==t.length?this.$t("formPrompt.codeLength"):t!==this.identifyCode?this.$t("formPrompt.codeDifferent"):void 0},langChange:function(t){var e=this;this.loginForm.lang!==t.text&&(this.loginForm.lang=t.text,this.$i18n.locale=t.value,Object(o.b)(t.value),this.$nextTick(function(){e.$router.replace({path:"/redirect"+e.$route.fullPath})})),this.showPicker=!1},onSubmit:function(t){var e=this,n=this.loginForm;this.$api.login.loginUser({j_username:n.userName,j_password:n.password,j_validation_code:n.code}).then(function(t){"850000"===t.code?(sessionStorage.setItem("userInfo",t.sid),e.$router.push({path:"/test"})):e.$toast.fail(e.$t("message.loginFail"))})}},watch:{},components:{Identify:n("VU/8")(i,a,!1,function(t){n("W52k")},"data-v-66042d41",null).exports},computed:{defaultIndex:function(){return"中文"===this.loginForm.lang?"0":"1"}}},s={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrapper"},[n("h4",{staticClass:"login-title"},[t._v(t._s(t.$t("login.loginTitle")))]),t._v(" "),n("van-form",{staticClass:"login-form",on:{submit:t.onSubmit}},[n("van-field",{attrs:{clearable:"",label:t.$t("login.userName"),placeholder:t.$t("login.userName"),rules:[{required:!0,message:t.$t("formPrompt.userName")}]},model:{value:t.loginForm.userName,callback:function(e){t.$set(t.loginForm,"userName",e)},expression:"loginForm.userName"}}),t._v(" "),n("van-field",{attrs:{clearable:"",type:t.pwdShow?"text":"password",label:t.$t("login.password"),placeholder:t.$t("login.password"),"right-icon":t.loginForm.password?"browsing-history":"",rules:[{required:!0,message:t.$t("formPrompt.password")}]},on:{"click-right-icon":function(e){t.pwdShow=!t.pwdShow}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}}),t._v(" "),n("van-field",{attrs:{center:"",clearable:"",label:t.$t("login.verification"),placeholder:t.$t("login.verification"),rules:[{validator:t.codeValidator,message:t.codeMessage}]},scopedSlots:t._u([{key:"button",fn:function(){return[n("Identify",{attrs:{identifyCode:t.identifyCode,contentWidth:115,contentHeight:40}})]},proxy:!0}]),model:{value:t.loginForm.code,callback:function(e){t.$set(t.loginForm,"code",e)},expression:"loginForm.code"}}),t._v(" "),n("van-field",{attrs:{readonly:"",clickable:"",value:t.loginForm.lang,"default-index":t.defaultIndex,label:t.$t("login.langSelect"),"right-icon":"arrow-down"},on:{click:function(e){t.showPicker=!0}}}),t._v(" "),n("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(e){t.showPicker=e},expression:"showPicker"}},[n("van-picker",{attrs:{"show-toolbar":"",columns:t.langData,title:t.$t("login.langSelect")},on:{confirm:t.langChange,cancel:function(e){t.showPicker=!1}}})],1),t._v(" "),n("div",{staticClass:"btn-submit"},[n("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v("\n        "+t._s(t.$t("login.loginTitle"))+"\n      ")])],1)],1)],1)},staticRenderFns:[]};var l=n("VU/8")(r,s,!1,function(t){n("Exlg")},"data-v-75da6e50",null);e.default=l.exports},W52k:function(t,e){}});